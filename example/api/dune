(library
 (name api_native)
 (libraries lwt dream remote_native)
 (flags
  :standard
  -open
  Ppx_yojson_conv_lib.Yojson_conv.Primitives
  -open
  Env_native)
 (preprocess
  (per_module
   ((pps remote_ppx ppx_yojson_conv)
    api)))
 (modes native))

(subdir
 browser
 (library
  (name api_browser)
  (modes melange)
  (flags
   :standard
   -open
   Ppx_yojson_conv_lib.Yojson_conv.Primitives
   -open
   Env_browser)
  (libraries remote_browser)
  (preprocess
   (pps ppx_yojson_conv remote_ppx -js)))
 (rule
  (target api_browser.ml)
  (deps ../api.ml)
  (action
   (copy# ../api.ml %{target}))))
